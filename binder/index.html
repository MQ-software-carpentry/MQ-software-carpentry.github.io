<html>
 <body>
  
 <style>
   body {
    font: normal 14px Verdana, Arial, sans-serif;
   }
 </style>
  
<br><br><br>
  
<h1 style="text-align:center">Binder Redirector - v1.6</h1>

<script>
 
  // Redirect to Binder Launch page based on information in the referrer url
  //
  // inbound url must contain:  .*?target=<targeturl-containing-USER-and-REPO>
  // USER and REPO will be replace with info from the referrer (assuming we come from a github READM.md page)
 
  referrer = document.referrer.split('/');
  site = referrer[2];
  user = referrer[3];
  repo = referrer[4];
 
  

  // user = "MQ-software-carpentry";
  // user = "";
 
 </script>
  
  <br><br><br>

  <div style="display: none; text-align: center;" id="original">
    <h2 style='color: red; text-align:center;'>Redirection Failed</h2>

    <p>
    It appears you have followed the Binder link from the original workshop
    <p>
    repository rather than the Binder link in your personal <em>fork</em> of the repository.

    <br><br><br>

    <p>
    Please return to your personal repository and follow that Binder link instead.

    <br><br>

    <p style="font-size: 7px;">
    <span onClick="launch();">Continue Anyway (you will not be able to push)</span>
  </div>
  
  <div style="display: none; text-align: center;" id="username">
    GitHub Username: 
    <input type="text" name="username" onkeyup="user = this.value; console.log('user: ', user, '\n'); ">
    
    <input type="submit" value="Launch" onClick="launch();">

    <br><br><br><br>

    <span style="font-size: 10px;" onclick="document.getElementById('workaround').style.display = 'block'">Chrome Workaround to Remove this Step</span>
    <div style="display: none;" id="workaround">

    <br><br><br><br>
    If this page requests your GitHub username, try disabling your
    <br>
    Chrome's <em>reduced-referrer-granularity</em> by cutting and pasting the following:
    <br><br>
    
    
    <strong>chrome://flags/#reduced-referrer-granularity</strong>
    
    <br><br><br>
    
    into Chrome, change <em>Reduce default 'referer' header granularity</em> to <em>Disabled</em> - then restart.
   
    <br><br><br> 
    <img src="referrer-disable.png" style="border: 5px solid #AAA">
  </div>
  
  <p style="text-align:center;">
  

   <script>

    if (user == "") {
      document.getElementById("username").style.display = "block";
    }
    else if (user == "MQ-software-carpentry") {
      document.getElementById("original").style.display = "block";
    }
    else {
      launch();     
    }

    function launch() {
     
      target =  document.URL.replace(/.*?target=/, '');
      binder = target.replace(/USER/, user);
     
      console.log('document.referrer: ', document.referrer);
      console.log('referrer: ', document.referrer.split('/'));
                  
      console.log('user: ', user, '\n');
      console.log('repo: ', repo, '\n');
     
      console.log('binder: ', binder, '\n');

      setTimeout(function(){ window.location.href = binder; }, 500);
    }
        
  </script>
   
  
 </body>
</html>
